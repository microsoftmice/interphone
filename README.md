					《人工智能+无线电应答平台》
									作者：BG7EJL
一、项目背景
目前市面上基于U/V频段的无线电应答应用，大多数将对讲机终端与APP或PC相结合，实现无线电网络与互联网的互联互通，如常见的“微喇”或其他PC端软件，其本质上解决了无线电网络的延伸问题。
那么，如何在此基础上更进一步发展，实现无线电网络在互联网的支撑下，借助人工智能语音识别功能与各行各业进行业务融合，是这个平台解决的主要问题。
下面我以U/V段对讲机进行实时天气、路况查询为应用，介绍这个平台的制作过程，并将最终作品的代码与原理图开源给所有爱好者。
二、系统功能框图

三、平台处理流程
1.用户通过普通对讲机进行道路态势请求呼叫。
2.平台客户端接受呼叫请求，并将音频数据发送至服务端。
3.服务端通过语音识别ASR功能将语音转换成文字，同时发送至高德路况查询服务器。
4.高德路况查询服务器根据请求内容返回实时路况信息给平台服务端。
5.平台服务端将路况信息通过TTS功能转换成语音数据，通过互联网发送至平台客户端。
6.平台客户端接受实时路况语音数据，通过U/V段无线电广播至用户对讲机。
四、制作细节（硬件部分）
1.主要硬件材料准备
1个SR-FRS-2WU模块；它基于数字信号处理技术的调频解调技术；频率范围：400M～480MHZ；频率步进可选择：5K/6.25K/12.5K/25K；RF 输出功率： 高功率1W,低功率0.5W；语音加密（扰频）功能；短信息 SMS 收发功能。
1个ESP32-A1S 模组；它是一款超小体积，功能强大的模组，主芯片采用低功耗双核 32 位 CPU，主频高达240MHz，运算能力高达 600 DMIPS，内置 AC101 Codec音频解码芯片,可以支持播放音乐和录音，内置 520 KB SRAM，外置 4MPSRAM，支持 UART/SPI/I2C/I2S/PWM/ADC/DAC 等。
1个ams1117-3.3模块；AMS1117-3.3是一种输出电压为3.3V的正向低压降稳压器。
3个轻触开关，6*6*8侧按开关；
1个拨动开关；
电容电阻二极管若干。
2.电路制作步骤：
将射频收发模块与微处理器连接。如图：

将PPT脚与IO12脚连接，实现射频发射可控；将SQ脚与IO5脚连接，实现射频接受可控；将AF-OUT脚与LINEIN脚连接，用于接受语音数据；将MIC-IN脚与HPOUT脚连接，用于发射语音数据；RXD\TXD分别连接IO4,IO5，实现处理器通过串口协议进行前期射频参数设置，如收发频率、发射功率、哑音、休眠模式等。
在这里我们设置射频收发频率为：450.0500，通过查询射频收发模块的操作手册，控制命令如下：AT+DMOSETGROUP=0，450.0500，450.2500，1，2，1，0(回车)
参数依次为： 
 0：窄带
 450.0500：发射频率（ MHZ）
 450.2500：接收频率 （ MHZ）
 1：接收亚音频:
 2：SQ 静噪
 1：发射亚音频 
 0：发射功率 1W, 压扩 OFF,繁忙禁发 OFF
通过AMS1117稳压电路，对整个平台提供稳压电源。如图：

在微控制器拉出2个引脚，分别实现对ESP32模块的复位和网络设置功能。如图：

其中，网络设置通过终端管理APP来实现，步骤如下：
①　下载并安装终端管理APP版，地址如下：
https://www.espressif.com/zh-hans/support/download/apps
②　设置当前WIFI网络的SSID，以及PASSWORD，点击CONFIRM。如图：

③　按下平台客户端的网络设置按键（长按3秒）
④　平台客户端将通过UDP协议自动获取APP设置的WIFI信息进行联网。
RXD、TXD程序烧录接口。如图：

其中，烧录功能通过FLASH_DOWNLOAD_TOOLS_V3.6.2.2工具进行。下载地址如下：
https://www.espressif.com/zh-hans/support/download/other-tools
配置方式如图：

制作完成后的PCB图如下：

五、制作细节（软件部分）
平台服务端采用WEB架构，JAVA语言开发。功能框图如下：

软件处理流程如下：
①　平台客户端将接收到的语音数据封装成HTTP流格式，实时上送到平台服务端；
②　服务端监听模块将HTTP包解封后，将语音数据传送至语音ASR识别服务模块。
③　ASR服务奖语音识别成文字后，开始调用业务处理模块。
④　业务处理模块将用户请求内容通过高德路况服务API接口，传送至高德服务器；并获取服务器返回的路况信息。
⑤　将路况信息结果进行语音TTS转换。
⑥　最后通过发送模块将语音封装成HTTP流格式，实时下发给平台客户端。

六、实时路况查询
通过以上步骤，将平台客户端WIFI网络、IP地址以及平台服务端配置好后，打开对讲机，将频率调至450.0500，开始与平台进行交互。
用户呼叫：北二环交通情况怎么样？
平台客户端应答：北二环目前道路畅通。
用户呼叫：芙蓉北路现在是否堵车？
平台客户端应答：芙蓉北路由南往北行驶缓慢。
用户呼叫：今天长沙天气如何？
平台客户端应答：今天长沙天气晴朗，气温25度，南风，适合出行。
。。。。。。。
视频地址:

七、各种业务场景应用
平台可通过提供的第3方二次开发接口，实现各种业务功能融合，如：自动定时语音播报，定时播放MP3,WAV文件；对U/V段通信的语音通话监控、过滤、记录、查询等；天气播报；路况查询、快递查询等。利用平台智能对答场景，实现用户各种业务处理，搭建安全、高效、易于管理的单位内部语音通信系统，适用于执勤、消防、物流、港口、医院等所有需要统一管理调度的场景。

最后感谢BG7XP许群主对项目的支持和帮助。
HAVE FUN！
附：
代码、原理图、PCB电路图下载地址：https://github.com/dodouegg
邮箱：dodouegg@qq.com